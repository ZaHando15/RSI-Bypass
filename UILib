-- BEAUTIFUL UI LIBRARY v2 | Dual-Pane Layout + Grid System
local UILibrary = {}
UILibrary.__index = UILibrary

-- Services
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")

-- PRESERVED CONFIG (exactly as in UISave)
local CONFIG = {
    Colors = {
        Background = Color3.fromRGB(25, 27, 30),
        TopBar = Color3.fromRGB(35, 38, 42),
        Content = Color3.fromRGB(45, 48, 54),
        Close = Color3.fromRGB(255, 85, 85),
        Minimize = Color3.fromRGB(255, 180, 70),
        Accent = Color3.fromRGB(85, 170, 255),
        Hover = Color3.fromRGB(60, 64, 72),
        Text = Color3.fromRGB(240, 240, 240),
        Shadow = Color3.fromRGB(0, 0, 0)
    },
    Sizes = {
        Width = 600,
        Height = 450,
        TopBar = 40,
        TabWidth = 130,
        CornerRadius = 14
    },
    Animation = {
        Speed = 0.3,
        Easing = Enum.EasingStyle.Quart,
        Direction = Enum.EasingDirection.Out
    }
}

-- Utility (unchanged)
local function tween(obj, props, dur)
    return TweenService:Create(obj, TweenInfo.new(
        dur or CONFIG.Animation.Speed,
        CONFIG.Animation.Easing,
        CONFIG.Animation.Direction
    ), props)
end

local function createShadow()
    local shadow = Instance.new("ImageLabel")
    shadow.Image = "rbxassetid://1316045217"
    shadow.ImageTransparency = 0.75
    shadow.BackgroundTransparency = 1
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(10, 10, 118, 118)
    shadow.Size = UDim2.new(1, 30, 1, 30)
    shadow.Position = UDim2.new(0, -15, 0, -15)
    shadow.ZIndex = -1
    return shadow
end

local function createCorner(radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius)
    return corner
end

-- Window Object
local Window = {}
Window.__index = Window

function Window:new(name, size, position)
    local self = setmetatable({}, Window)
    
    local playerGui = Players.LocalPlayer:WaitForChild("PlayerGui")
    
    -- Create Window Frame
    self.ScreenGui = Instance.new("ScreenGui")
    self.ScreenGui.Name = name .. "Window"
    self.ScreenGui.ResetOnSpawn = false
    self.ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    self.ScreenGui.Parent = playerGui
    
    self.MainFrame = Instance.new("Frame")
    self.MainFrame.Size = size or UDim2.new(0, CONFIG.Sizes.Width, 0, CONFIG.Sizes.Height)
    self.MainFrame.Position = position or UDim2.new(0.5, -CONFIG.Sizes.Width/2, 0.5, -CONFIG.Sizes.Height/2)
    self.MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    self.MainFrame.BackgroundColor3 = CONFIG.Colors.Background
    self.MainFrame.BorderSizePixel = 0
    self.MainFrame.ClipsDescendants = true
    self.MainFrame.Parent = self.ScreenGui
    
    createCorner(CONFIG.Sizes.CornerRadius):Clone().Parent = self.MainFrame
    createShadow().Parent = self.MainFrame
    
    -- Top Bar (exactly as in UISave)
    self.TopBar = Instance.new("Frame")
    self.TopBar.Size = UDim2.new(1, 0, 0, CONFIG.Sizes.TopBar)
    self.TopBar.BackgroundColor3 = CONFIG.Colors.TopBar
    self.TopBar.BorderSizePixel = 0
    self.TopBar.ZIndex = 10
    self.TopBar.Parent = self.MainFrame
    
    local topGradient = Instance.new("UIGradient")
    topGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, CONFIG.Colors.TopBar),
        ColorSequenceKeypoint.new(1, CONFIG.Colors.TopBar:Lerp(Color3.new(0,0,0), 0.1))
    }
    topGradient.Parent = self.TopBar
    
    self.Title = Instance.new("TextLabel")
    self.Title.Size = UDim2.new(1, -100, 1, 0)
    self.Title.Position = UDim2.new(0, 15, 0, 0)
    self.Title.BackgroundTransparency = 1
    self.Title.Text = name
    self.Title.TextColor3 = CONFIG.Colors.Text
    self.Title.TextSize = 18
    self.Title.Font = Enum.Font.GothamSemibold
    self.Title.TextXAlignment = Enum.TextXAlignment.Left
    self.Title.Parent = self.TopBar
    
    -- Control Buttons (exactly as in UISave)
    self.CloseBtn = Instance.new("TextButton")
    self.CloseBtn.Size = UDim2.new(0, 38, 0, 25)
    self.CloseBtn.Position = UDim2.new(1, -45, 0.5, -12.5)
    self.CloseBtn.BackgroundColor3 = CONFIG.Colors.Close
    self.CloseBtn.BorderSizePixel = 0
    self.CloseBtn.Text = ""
    self.CloseBtn.AutoButtonColor = false
    self.CloseBtn.ZIndex = 11
    self.CloseBtn.Parent = self.TopBar
    
    local closeIcon = Instance.new("TextLabel")
    closeIcon.Size = UDim2.new(1, 0, 1, 0)
    closeIcon.BackgroundTransparency = 1
    closeIcon.Text = "✕"
    closeIcon.TextColor3 = CONFIG.Colors.Text
    closeIcon.TextSize = 14
    closeIcon.Font = Enum.Font.GothamBold
    closeIcon.Parent = self.CloseBtn
    
    self.MinBtn = Instance.new("TextButton")
    self.MinBtn.Size = UDim2.new(0, 38, 0, 25)
    self.MinBtn.Position = UDim2.new(1, -85, 0.5, -12.5)
    self.MinBtn.BackgroundColor3 = CONFIG.Colors.Minimize
    self.MinBtn.BorderSizePixel = 0
    self.MinBtn.Text = ""
    self.MinBtn.AutoButtonColor = false
    self.MinBtn.ZIndex = 11
    self.MinBtn.Parent = self.TopBar
    
    local minIcon = Instance.new("TextLabel")
    minIcon.Size = UDim2.new(1, 0, 1, 0)
    minIcon.BackgroundTransparency = 1
    minIcon.Text = "−"
    minIcon.TextColor3 = CONFIG.Colors.Text
    minIcon.TextSize = 18
    minIcon.Font = Enum.Font.GothamBold
    minIcon.Parent = self.MinBtn
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = self.CloseBtn
    btnCorner:Clone().Parent = self.MinBtn
    
    -- ===== DUAL-PANE LAYOUT =====
    -- Left Tabs Container
    self.TabsPanel = Instance.new("Frame")
    self.TabsPanel.Name = "TabsPanel"
    self.TabsPanel.Size = UDim2.new(0, CONFIG.Sizes.TabWidth, 1, -CONFIG.Sizes.TopBar)
    self.TabsPanel.Position = UDim2.new(0, 0, 0, CONFIG.Sizes.TopBar)
    self.TabsPanel.BackgroundColor3 = CONFIG.Colors.Content:Lerp(Color3.new(0,0,0), 0.1)
    self.TabsPanel.BorderSizePixel = 0
    self.TabsPanel.Parent = self.MainFrame
    
    local tabsCorner = Instance.new("UICorner")
    tabsCorner.CornerRadius = UDim.new(0, CONFIG.Sizes.CornerRadius)
    tabsCorner.Parent = self.TabsPanel
    
    -- Right Content Container with Grid
    self.ContentPanel = Instance.new("Frame")
    self.ContentPanel.Name = "ContentPanel"
    self.ContentPanel.Size = UDim2.new(1, -CONFIG.Sizes.TabWidth, 1, -CONFIG.Sizes.TopBar)
    self.ContentPanel.Position = UDim2.new(0, CONFIG.Sizes.TabWidth, 0, CONFIG.Sizes.TopBar)
    self.ContentPanel.BackgroundTransparency = 1
    self.ContentPanel.BorderSizePixel = 0
    self.ContentPanel.Parent = self.MainFrame
    
    -- Grid Layout for components
    self.GridLayout = Instance.new("UIGridLayout")
    self.GridLayout.CellSize = UDim2.new(0, 250, 0, 45)
    self.GridLayout.CellPadding = UDim2.new(0, 15, 0, 15)
    self.GridLayout.SortOrder = Enum.SortOrder.LayoutOrder
    self.GridLayout.Parent = self.ContentPanel
    
    -- State Management
    self.isMinimized = false
    self.originalSize = self.MainFrame.Size
    self.tabs = {}
    self.activeTab = nil
    
    -- Setup Events
    self:SetupEvents()
    
    -- Open Animation
    self.MainFrame.Size = UDim2.new(0, 0, 0, 0)
    self.MainFrame.BackgroundTransparency = 1
    tween(self.MainFrame, {Size = self.originalSize, BackgroundTransparency = 0}, 0.5):Play()
    
    return self
end

function Window:SetupEvents()
    -- Dragging (preserved from UISave)
    local dragging = false
    local dragStart = Vector2.new()
    local frameStart = UDim2.new()
    
    self.TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            frameStart = self.MainFrame.Position
        end
    end)
    
    UIS.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UIS.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            self.MainFrame.Position = UDim2.new(
                frameStart.X.Scale,
                frameStart.X.Offset + delta.X,
                frameStart.Y.Scale,
                frameStart.Y.Offset + delta.Y
            )
        end
    end)
    
    -- Minimize/Close (preserved from UISave)
    self.MinBtn.MouseButton1Click:Connect(function()
        self.isMinimized = not self.isMinimized
        if self.isMinimized then
            self.originalSize = self.MainFrame.Size
            tween(self.MainFrame, {Size = UDim2.new(0, CONFIG.Sizes.Width, 0, CONFIG.Sizes.TopBar)}, 0.3):Play()
            tween(self.ContentPanel, {BackgroundTransparency = 1}, 0.3):Play()
            tween(self.TabsPanel, {BackgroundTransparency = 1}, 0.3):Play()
        else
            tween(self.MainFrame, {Size = self.originalSize}, 0.3):Play()
            tween(self.ContentPanel, {BackgroundTransparency = 0}, 0.3):Play()
            tween(self.TabsPanel, {BackgroundTransparency = 0}, 0.3):Play()
        end
    end)
    
    self.CloseBtn.MouseButton1Click:Connect(function()
        tween(self.MainFrame, {Size = UDim2.new(0, 0, 0, 0)}, 0.3):Play()
        tween(self.MainFrame, {BackgroundTransparency = 1}, 0.3):Play()
        wait(0.3)
        self.ScreenGui:Destroy()
    end)
    
    -- Hover Effects (preserved from UISave)
    self.CloseBtn.MouseEnter:Connect(function()
        tween(self.CloseBtn, {BackgroundColor3 = CONFIG.Colors.Hover, Size = UDim2.new(0, 40, 0, 27)}, 0.2):Play()
    end)
    
    self.CloseBtn.MouseLeave:Connect(function()
        tween(self.CloseBtn, {BackgroundColor3 = CONFIG.Colors.Close, Size = UDim2.new(0, 38, 0, 25)}, 0.2):Play()
    end)
    
    self.MinBtn.MouseEnter:Connect(function()
        tween(self.MinBtn, {BackgroundColor3 = CONFIG.Colors.Hover, Size = UDim2.new(0, 40, 0, 27)}, 0.2):Play()
    end)
    
    self.MinBtn.MouseLeave:Connect(function()
        tween(self.MinBtn, {BackgroundColor3 = CONFIG.Colors.Minimize, Size = UDim2.new(0, 38, 0, 25)}, 0.2):Play()
    end)
end

function Window:Tab(name)
    -- Create Tab Button (left panel)
    local tabBtn = Instance.new("TextButton")
    tabBtn.Name = name .. "TabButton"
    tabBtn.Size = UDim2.new(1, -10, 0, 35)
    tabBtn.Position = UDim2.new(0, 5, 0, 10 + (#self.tabs * 45))
    tabBtn.BackgroundColor3 = CONFIG.Colors.Content:Lerp(Color3.new(0,0,0), 0.3)
    tabBtn.BorderSizePixel = 0
    tabBtn.Text = "  " .. name
    tabBtn.TextColor3 = CONFIG.Colors.Text
    tabBtn.TextSize = 14
    tabBtn.Font = Enum.Font.GothamSemibold
    tabBtn.TextXAlignment = Enum.TextXAlignment.Left
    tabBtn.AutoButtonColor = false
    tabBtn.Parent = self.TabsPanel
    
    local tabBtnCorner = Instance.new("UICorner")
    tabBtnCorner.CornerRadius = UDim.new(0, 6)
    tabBtnCorner.Parent = tabBtn
    
    -- Create Tab Content (right panel)
    local tabContent = Instance.new("ScrollingFrame")
    tabContent.Name = name .. "TabContent"
    tabContent.Size = UDim2.new(1, 0, 1, 0)
    tabContent.BackgroundTransparency = 1
    tabContent.BorderSizePixel = 0
    tabContent.ScrollBarThickness = 4
    tabContent.ScrollBarImageColor3 = CONFIG.Colors.Accent
    tabContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
    tabContent.Visible = false
    tabContent.Parent = self.ContentPanel
    
    -- Grid Layout for components
    local gridLayout = Instance.new("UIGridLayout")
    gridLayout.CellSize = UDim2.new(0, 250, 0, 45)
    gridLayout.CellPadding = UDim2.new(0, 15, 0, 15)
    gridLayout.SortOrder = Enum.SortOrder.LayoutOrder
    gridLayout.Parent = tabContent
    
    -- Tab Data
    local tabData = {
        Name = name,
        Button = tabBtn,
        Content = tabContent,
        GridLayout = gridLayout,
        IsActive = false
    }
    
    table.insert(self.tabs, tabData)
    
    -- Activate first tab by default
    if #self.tabs == 1 then
        self.activeTab = tabData
        tabData.IsActive = true
        tabBtn.BackgroundColor3 = CONFIG.Colors.Accent
        tabContent.Visible = true
    end
    
    -- Tab Click Logic
    tabBtn.MouseButton1Click:Connect(function()
        -- Deactivate current tab
        if self.activeTab then
            self.activeTab.IsActive = false
            self.activeTab.Button.BackgroundColor3 = CONFIG.Colors.Content:Lerp(Color3.new(0,0,0), 0.3)
            self.activeTab.Content.Visible = false
        end
        
        -- Activate clicked tab
        tabData.IsActive = true
        tabData.Button.BackgroundColor3 = CONFIG.Colors.Accent
        tabData.Content.Visible = true
        self.activeTab = tabData
    end)
    
    -- Return Tab Object with Component Methods
    local tabObj = {}
    tabObj.__index = tabObj
    
    function tabObj:Label(text)
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0, 250, 0, 25)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = CONFIG.Colors.Text
        label.TextSize = 14
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = self.Content
        return label
    end
    
    function tabObj:Button(text, callback)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0, 250, 0, 45)
        btn.BackgroundColor3 = CONFIG.Colors.Accent
        btn.BorderSizePixel = 0
        btn.Text = text
        btn.TextColor3 = CONFIG.Colors.Text
        btn.TextSize = 16
        btn.Font = Enum.Font.GothamSemibold
        btn.AutoButtonColor = false
        btn.Parent = self.Content
        
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 8)
        btnCorner.Parent = btn
        
        btn.MouseButton1Click:Connect(function()
            tween(btn, {Size = UDim2.new(0, 240, 0, 42)}, 0.1):Play()
            wait(0.1)
            tween(btn, {Size = UDim2.new(0, 250, 0, 45)}, 0.1):Play()
            if callback then callback() end
        end)
        
        return btn
    end
    
    function tabObj:Toggle(text, callback)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(0, 250, 0, 45)
        container.BackgroundTransparency = 1
        container.Parent = self.Content
        
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.6, 0, 1, 0)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = CONFIG.Colors.Text
        label.TextSize = 14
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = container
        
        local toggleBtn = Instance.new("TextButton")
        toggleBtn.Size = UDim2.new(0, 50, 0, 25)
        toggleBtn.Position = UDim2.new(0.7, 0, 0.5, -12.5)
        toggleBtn.BackgroundColor3 = CONFIG.Colors.Content:Lerp(Color3.new(0,0,0), 0.3)
        toggleBtn.BorderSizePixel = 0
        toggleBtn.Text = ""
        toggleBtn.AutoButtonColor = false
        toggleBtn.Parent = container
        
        local toggleCorner = Instance.new("UICorner")
        toggleCorner.CornerRadius = UDim.new(0, 12)
        toggleCorner.Parent = toggleBtn
        
        local toggleDot = Instance.new("Frame")
        toggleDot.Size = UDim2.new(0, 21, 0, 21)
        toggleDot.Position = UDim2.new(0, 2, 0.5, -10.5)
        toggleDot.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        toggleDot.BorderSizePixel = 0
        toggleDot.Parent = toggleBtn
        
        local dotCorner = Instance.new("UICorner")
        dotCorner.CornerRadius = UDim.new(0, 10)
        dotCorner.Parent = toggleDot
        
        local state = false
        
        toggleBtn.MouseButton1Click:Connect(function()
            state = not state
            tween(toggleBtn, {BackgroundColor3 = state and CONFIG.Colors.Accent or CONFIG.Colors.Content:Lerp(Color3.new(0,0,0), 0.3)}, 0.2):Play()
            tween(toggleDot, {Position = state and UDim2.new(1, -23, 0.5, -10.5) or UDim2.new(0, 2, 0.5, -10.5)}, 0.2):Play()
            if callback then callback(state) end
        end)
        
        return container
    end
    
    function tabObj:Slider(text, min, max, callback)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(0, 250, 0, 60)
        container.BackgroundTransparency = 1
        container.Parent = self.Content
        
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.4, 0, 0, 20)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = CONFIG.Colors.Text
        label.TextSize = 14
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = container
        
        local valueLabel = Instance.new("TextLabel")
        valueLabel.Size = UDim2.new(0.6, 0, 0, 20)
        valueLabel.Position = UDim2.new(0.4, 0, 0, 0)
        valueLabel.BackgroundTransparency = 1
        valueLabel.Text = tostring(min)
        valueLabel.TextColor3 = CONFIG.Colors.Text
        valueLabel.TextSize = 14
        valueLabel.Font = Enum.Font.Gotham
        valueLabel.TextXAlignment = Enum.TextXAlignment.Right
        valueLabel.Parent = container
        
        local sliderBg = Instance.new("Frame")
        sliderBg.Size = UDim2.new(1, 0, 0, 8)
        sliderBg.Position = UDim2.new(0, 0, 1, -8)
        sliderBg.BackgroundColor3 = CONFIG.Colors.Content:Lerp(Color3.new(0,0,0), 0.4)
        sliderBg.BorderSizePixel = 0
        sliderBg.Parent = container
        
        local sliderCorner = Instance.new("UICorner")
        sliderCorner.CornerRadius = UDim.new(0, 4)
        sliderCorner.Parent = sliderBg
        
        local sliderFill = Instance.new("Frame")
        sliderFill.Size = UDim2.new(0, 0, 1, 0)
        sliderFill.BackgroundColor3 = CONFIG.Colors.Accent
        sliderFill.BorderSizePixel = 0
        sliderFill.Parent = sliderBg
        
        local fillCorner = Instance.new("UICorner")
        fillCorner.CornerRadius = UDim.new(0, 4)
        fillCorner.Parent = sliderFill
        
        local sliderHandle = Instance.new("TextButton")
        sliderHandle.Size = UDim2.new(0, 16, 0, 16)
        sliderHandle.Position = UDim2.new(0, -8, 0.5, -8)
        sliderHandle.BackgroundColor3 = CONFIG.Colors.Text
        sliderHandle.BorderSizePixel = 0
        sliderHandle.Text = ""
        sliderHandle.AutoButtonColor = false
        sliderHandle.Parent = sliderBg
        
        local handleCorner = Instance.new("UICorner")
        handleCorner.CornerRadius = UDim.new(0, 8)
        handleCorner.Parent = sliderHandle
        
        local value = min or 0
        local maxVal = max or 100
        local dragging = false
        
        sliderHandle.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
            end
        end)
        
        UIS.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)
        
        UIS.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local mouseX = input.Position.X
                local sliderX = sliderBg.AbsolutePosition.X
                local sliderWidth = sliderBg.AbsoluteSize.X
                local percent = math.clamp((mouseX - sliderX) / sliderWidth, 0, 1)
                
                sliderFill.Size = UDim2.new(percent, 0, 1, 0)
                sliderHandle.Position = UDim2.new(percent, -8, 0.5, -8)
                
                value = math.floor(percent * maxVal)
                valueLabel.Text = tostring(value)
                if callback then callback(value) end
            end
        end)
        
        return container
    end
    
    return tabObj
end

-- Main Library Constructor (unchanged)
function UILibrary:new(name, size, position)
    return Window:new(name, size, position)
end

-- Return for loadstring
return UILibrary
